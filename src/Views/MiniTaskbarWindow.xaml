<?xml version="1.0" encoding="utf-8" ?>
<Window xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
        xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
        xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
        x:Class="ADHDWorkspace.Views.MiniTaskbarWindow"
        Title="ADHD Workspace"
        Width="275"
        Height="75"
        x:Name="mainWindow">

    <ContentPage BackgroundColor="{StaticResource BackgroundDark}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="6" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Drag Bar -->
        <BoxView Grid.Row="0"
                 Color="#3A3A3A"
                 HeightRequest="8">
            <BoxView.GestureRecognizers>
                <PanGestureRecognizer PanUpdated="OnDragBarPanUpdated" />
            </BoxView.GestureRecognizers>
        </BoxView>

        <!-- Header with Clock, Pomodoro, Focus, Close -->
        <Grid Grid.Row="1"
              Padding="0"
              HeightRequest="65">
            
            <HorizontalStackLayout HorizontalOptions="End"
                                   Spacing="0"
                                   Padding="0,5,5,0">
                
                <!-- Clock - Very Visible -->
                <Button x:Name="ClockLabel"
                        Text="12:00"
                        BackgroundColor="Transparent"
                        BorderWidth="0"
                        Padding="0"
                        FontSize="32"
                        FontAttributes="Bold"
                        TextColor="{StaticResource PrimaryText}"
                        WidthRequest="140"
                        HeightRequest="50"
                        HorizontalOptions="End"
                        Clicked="OnClockTapped" />

                <!-- Pomodoro Indicator -->
                <Button x:Name="PomodoroLabel"
                        BackgroundColor="Transparent"
                        BorderWidth="0"
                        Padding="0"
                        WidthRequest="40"
                        HeightRequest="50"
                        ToolTipProperties.Text="Pomodoro"
                        Clicked="OnPomodoroTapped">
                    <Button.ImageSource>
                        <FontImageSource x:Name="PomodoroIconSource"
                                         Glyph="{StaticResource IconPomodoroGlyph}"
                                         FontFamily="{StaticResource IconFontFamily}"
                                         Size="20"
                                         Color="{StaticResource PomodoroIdle}" />
                    </Button.ImageSource>
                </Button>

                <!-- Focus Indicator -->
                <Button x:Name="FocusLabel"
                        BackgroundColor="Transparent"
                        BorderWidth="0"
                        Padding="0"
                        WidthRequest="40"
                        HeightRequest="50"
                        ToolTipProperties.Text="Focus Tracker"
                        Clicked="OnFocusTapped">
                    <Button.ImageSource>
                        <FontImageSource x:Name="FocusIconSource"
                                         Glyph="{StaticResource IconFocusGlyph}"
                                         FontFamily="{StaticResource IconFontFamily}"
                                         Size="20"
                                         Color="{StaticResource FocusIdle}" />
                    </Button.ImageSource>
                </Button>

                <!-- Settings Button -->
                <Button Text="{StaticResource IconSettingsGlyph}"
                        FontFamily="{StaticResource IconFontFamily}"
                        BackgroundColor="Transparent"
                        BorderWidth="0"
                        Padding="0"
                        FontSize="20"
                        TextColor="#B0B0B0"
                        WidthRequest="38"
                        HeightRequest="50"
                        ToolTipProperties.Text="Settings"
                        Clicked="OnSettingsTapped" />

            </HorizontalStackLayout>
        </Grid>

        <!-- Progress Bar - Visible with Time Overlay -->
        <Grid Grid.Row="2" Margin="10,2,10,2">
            <ProgressBar x:Name="PomodoroProgressBar"
                         Progress="0"
                         ProgressColor="{StaticResource PomodoroActive}"
                         BackgroundColor="#282828"
                         HeightRequest="14" />
            <Label x:Name="PomodoroTimeLabel"
                   Text=""
                   FontSize="10"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   IsVisible="False"
                   InputTransparent="True" />
        </Grid>

        <!-- Expanded Content -->
        <Grid x:Name="ExpandedContent"
              Grid.Row="3"
              IsVisible="False"
              Padding="10">
            
             <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
             </Grid.RowDefinitions>

             <!-- Focus Task Label -->
             <Label x:Name="FocusTaskLabel"
                 Grid.Row="0"
                 Text=""
                 FontSize="10"
                 FontAttributes="Bold"
                 TextColor="{StaticResource FocusIdle}"
                 Margin="0,0,0,10" />

             <!-- Focus Mode Toggle -->
             <HorizontalStackLayout Grid.Row="1"
                        Spacing="10"
                        VerticalOptions="Center">
              <Label Text="Focus Mode"
                  Style="{StaticResource BodyText}" />
              <Switch x:Name="FocusModeSwitch"
                   OnColor="{StaticResource AccentGreen}"
                   Toggled="OnFocusModeToggled" />
             </HorizontalStackLayout>

             <!-- App Buttons Grid -->
            <ScrollView x:Name="AppButtonsScrollView"
                        Grid.Row="2"
                        VerticalScrollBarVisibility="Always">
              <Grid x:Name="AppButtonsGrid"
                 RowDefinitions="80,80,80,80"
                 ColumnDefinitions="*,*"
                 RowSpacing="10"
                 ColumnSpacing="10">

                <!-- VS Code -->
                <Button Grid.Row="0" Grid.Column="0"
                        Text="VS Code"
                        BackgroundColor="#007ACC"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        Clicked="OnVSCodeClicked" />

                <!-- Teams -->
                <Button Grid.Row="0" Grid.Column="1"
                        Text="Teams"
                        BackgroundColor="#5F4B8B"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        Clicked="OnTeamsClicked" />

                <!-- Outlook -->
                <Button Grid.Row="1" Grid.Column="0"
                        Text="Outlook"
                        BackgroundColor="#0072C6"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        Clicked="OnOutlookClicked" />

                <!-- Obsidian -->
                <Button Grid.Row="1" Grid.Column="1"
                        Text="Obsidian"
                        BackgroundColor="#7B3FE4"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        Clicked="OnObsidianClicked" />

                <!-- Terminal -->
                <Button Grid.Row="2" Grid.Column="0"
                        Text="Terminal"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        Clicked="OnTerminalClicked" />

                <!-- Edge -->
                <Button Grid.Row="2" Grid.Column="1"
                        Text="Edge"
                        BackgroundColor="#0067C0"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        Clicked="OnEdgeClicked" />

                <!-- Save Context -->
                <Button Grid.Row="3" Grid.Column="0"
                        Text="Save"
                        BackgroundColor="#4682B4"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        ContentLayout="Left,8"
                        Clicked="OnSaveContextClicked">
                    <Button.ImageSource>
                        <FontImageSource Glyph="{StaticResource IconSaveGlyph}"
                                         FontFamily="{StaticResource IconFontFamily}"
                                         Color="White" />
                    </Button.ImageSource>
                </Button>

                <!-- Restore Context -->
                <Button Grid.Row="3" Grid.Column="1"
                        Text="Restore"
                        BackgroundColor="#DC7800"
                        TextColor="White"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="4"
                        ContentLayout="Left,8"
                        Clicked="OnRestoreContextClicked">
                    <Button.ImageSource>
                        <FontImageSource Glyph="{StaticResource IconRestoreGlyph}"
                                         FontFamily="{StaticResource IconFontFamily}"
                                         Color="White" />
                    </Button.ImageSource>
                </Button>
                </Grid>
            </ScrollView>
        </Grid>
    </Grid>
    </ContentPage>
</Window>
